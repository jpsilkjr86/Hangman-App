<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Hangman App</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  </head>

  <body onload="startUp()">
    <div class="container">

      <!-- Put text in jumbotron for visibility -->
    	<div class="jumbotron text-center">

	        <h1>Let's play hangman!</h1>

	        <!-- Empty elements, replaced by JavaScript functions during certain events -->
	        <p><span id="gameBoardText" class="text-success"></span></p>

			<p><span id="gameMsgText" class="text-muted">Press any key to get started.</span></p>

	        <p><strong><span id="gameResultText" class="text-primary"></span></strong></p>

	        <p><span id="lettersGuessedText" class="text-warning"></span></p>

	        <p><span id="attemptsRemainingText" class="text-danger"></span></p>

	        <p><strong><span id="gameBoardText" class="text-success"></span></strong></p>

	        <br><br>

	        <p><span id="scoreBoardText" class="text-info"></span></p>

    	</div>
    </div>

    <!-- BEGIN JAVASCRIPT -->
    <script type="text/javascript">
      
		// ******PSEUDO-CODE******

		// 1) HTML page displays game screen with CSS styles

		// 2) Dipslay "Press any key to start" - Game waits until any key is pressed before starting

		// 3) User Presses Key, Game Function Starts

		//    i) Generate random answer word (from libray or list?)

		//    ii) Display a game board with a series of blanks equal to the number of characters in the answer word

		//    iii) User presses key to guess a letter

		//    iv) Call function to compare guess letter to each letter of the answer word

		//       a) if right, change game board to include all letters matching the guessed letter

		//       b) if wrong, take one life away

		//       c) if all letters are correct, display victory

		//    v) Loop through 3-ii, 3-iii and 3-iv items above until attempts remaining run out or until word is guessed


		// ******DECLARE GLOBAL VARIABLES*******
		
		// gameOver is passed back and forth between the two main functions startUp() and gameFunction()
		// initial value set to true
		var gameOver = true;

		// Set the word libary to global. Needs to be global so that it can be updated through multiple calls of gameFunction
		var wordLibrary = ["library", "hippie", "continent", "biology", 
		"javascript", "cuisine", "pomegranate", "tropical", "technology"]

		// numOfWins and numOfLosses set to 0. They're global so that they can be changed on multiple function 
		// calls of startUp() and gameFunction()
		var numOfWins = 0;
		var numOfLosses = 0;



		// ******INITIALIZE GAME****** -- onkeyup event starts the gameFunction program IF gameOver is true
		
		function startUp()
		{
			document.onkeyup = function(event)
			{
				console.log("is this working?");
				if (gameOver)
				{
				   	// Clears the board when this function is called for restarting the game.
				   	clearMessage("gameResultText"); 
				   	clearMessage("attemptsRemainingText"); 
				   	clearMessage("lettersGuessedText");

				   	printMessage("gameMsgText", "Now press any letter key to guess a letter!");
				   	gameFunction();
				}
			}
		}

		


		// ******DECLARE FUNCTIONS*******

		// MAIN GAME FUNCTION -- to carry out and order all tasks, called when user presses a key (see above)
		function gameFunction ()
		{
			console.log("Game starts");

			// set gameOver to false at the beginning of each game.
		   	gameOver = false;

			// Declare local variables scoped to gameFunction, set their initial values
			var attemptsRemaining = 10;
			var letterGuessed = "";	 // user input variable for guessed letters			
			var gameWordAnswer = "";
			var numOfGuessedLetters = 0;   // to be used as the index for lettersGuessedArray[] when adding new letters
			var lettersGuessedArray = [""];  //running list of all guessed letters, right and wrong.
			var gameBoardArray = [""];  // Running list of correct letters, i.e. the user's Hangman Game Board

			// Generate one random game word
			gameWordAnswer = genGameWord();
			console.log("gameWordAnswer: " + gameWordAnswer);

			// Generate game board, same length as gameWordAnswer but letters replace by spaces.
			gameBoardArray = genGameBoard(gameWordAnswer);
			console.log("gameBoardArray: " + gameBoardArray);

			// Print game board, which at this point will be all blank
			printGameBoard(gameBoardArray);

			// Main game procresses, triggered by input between keycodes 65 (a) and 90 (z)
			document.onkeyup = function(event)
			{
				if (event.keyCode >= 65 && event.keyCode <= 90)
			   	{
			   		// Always converts the guessed letter to lowercase and displays it for the user
			   		letterGuessed = event.key.toLowerCase();
			   		printMessage("gameMsgText", "You guessed: ", letterGuessed);

			   		// Condition is a function which checks to see if letter was already guessed (returns bool)
					if (wasLetterAlreadyGuessed(letterGuessed, lettersGuessedArray))
					{ printMessage("gameResultText", "Letter was already guessed."); }

					else // I.e. if letter was not already guessed
					{
						// Add letterGuessed to the list of guessed letters in lettersGuessedArray.
						// Did not use "push" because of an issue where it would push the first added letter to index 1 
						// rather than index 0, since the array was declared as an empty string. Not sure how to fix that.				
						lettersGuessedArray[numOfGuessedLetters] = letterGuessed;
						numOfGuessedLetters++;
						printMessage("lettersGuessedText", "List of Guessed Letters: ", lettersGuessedArray);
						
						// Condition is a function which checks to see if letter was correct (returns bool)
						if (isLetterCorrect(letterGuessed, gameWordAnswer))
						{
							// Update and print the game board
							gameBoardArray = updateGameBoard(letterGuessed, gameWordAnswer, gameBoardArray);
							printGameBoard(gameBoardArray);
							console.log("gameBoardArray: " + gameBoardArray);

							// Condition is a function which checks to see if all board letters are complete (returns bool)
							if (areAllLettersOk(gameWordAnswer, gameBoardArray))
						   	{
						   		numOfWins++;
						   		gameOver = true;						   		
						   		printYouWin();						   		
						   		console.log("gameOver:", gameOver);
						   		startUp(); //calls the startUp function to kick the game initialization onkeyup function into gear
						   		return;
						   	}
						   	else { printMessage("gameResultText", "Match! See game board."); }
						}
						else  // I.e. if letter is not correct
						{							
							attemptsRemaining--;
							printMessage("attemptsRemainingText", "Attempts Remaining: ", attemptsRemaining);
							if (attemptsRemaining === 0)
						    {
						   		numOfLosses++;
						   		gameOver = true;
						   		printYouLose();
						   		console.log("gameOver:", gameOver);
						   		startUp(); //calls the startUp function to kick the game initialization onkeyup function into gear
						   		return;
						    }
							else  // I.e. if the letter is not correct but there are still remaining attempts
							{ printMessage("gameResultText", "Incorrect guess. Try again!"); }				
						}
					}						
				} //end of keycode input conditional 
			} //end of document.onkeyup
		} //end gameFunction


		// This function can print messages with or without the third optional argument!
		function printMessage(elementId, msg, opArg)
		{
			// used " == nule" so that the condition is true for either null or undefined arguments
			if (opArg == null)
			{document.getElementById(elementId).innerHTML = msg;}
			else
			{document.getElementById(elementId).innerHTML = msg + opArg;}
		}

		function clearMessage(elementId)
		{ document.getElementById(elementId).innerHTML = ""; }

		function genGameWord()
		{
			var x = Math.floor(Math.random() * wordLibrary.length);
			return (wordLibrary[x]);
			// return "testword";
		}


		function genGameBoard(gmWrd)
		{
			var arrayX = [""];
			for (g=0; g<gmWrd.length; g++)
			{
				arrayX[g] = " " + "_" + " ";
			}
			console.log("arrayX: " + arrayX);
			return arrayX;
		}

		function printGameBoard(gmBrd)
		{
			// .join is a function i looked up that converts an array of characters into a string.
			var stringX = gmBrd.join(" ");
			document.getElementById("gameBoardText").innerHTML = stringX;
		}

		function wasLetterAlreadyGuessed(ltr, ary)
		{
			for (i=0; i<26; i++)
			{
				if (ary[i] === ltr)
				{ return true; }
			}
			// if function exits the loop then must return false
			return false;
		}

		function isLetterCorrect(ltr, gmWrd)
		{
			for (j=0; j<gmWrd.length; j++)
			{
				if (gmWrd[j] === ltr)
				{ return true; }
			}
			// if function exits the loop then must return false
			return false;
		}

		function updateGameBoard(ltr, gmWrd, gmBrd)
		{
			for (k=0; k<gmWrd.length; k++)
			{
				if (gmWrd[k] === ltr)
				{ gmBrd[k] = ltr; }
			}
			// always return arrayY at the end
			return gmBrd;
		}

		function areAllLettersOk(gmWrd, gmBrd)
		{
			console.log("areAllLettersOk function, gameWordAnswer:", gmWrd);
			console.log("areAllLettersOk function, gameBoardArray:", gmBrd);
			for (m=0; m<gmWrd.length; m++)
			{
				if (gmBrd[m] !== gmWrd[m])
				{ return false; }
			}
			// if function can exit the for loop, then it must be true that All Letters are Ok
			return true;
		}

		function printYouLose()
		{
			document.getElementById("gameResultText").innerHTML = "Sorry! You lose.";
			document.getElementById("gameMsgText").innerHTML = "Press any key to play again.";
			document.getElementById("scoreBoardText").innerHTML = "Wins: " + numOfWins + "<br>Losses: " + numOfLosses;
		}

		function printYouWin()
		{
			document.getElementById("gameResultText").innerHTML = "Good job! You win!";
		   	document.getElementById("gameMsgText").innerHTML = "Press any key to play again.";
		   	document.getElementById("scoreBoardText").innerHTML = "Wins: " + numOfWins + "<br>Losses: " + numOfLosses;
		}


    </script>
    
  </body>
</html>